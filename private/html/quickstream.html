<div id="global-lead" class="text-center">
  <br/>
  <h1 class="display-2">Start a quick stream</h1>
  <hr>
  <p style="font-size:36px">
    <input id="streamkey" type="password" readonly value="" style="padding:0;width:350px;text-align:center"/>
  </p>
  <p>
    <button id="showstreamkey" class="btn btn-primary ml-3" style="font-size:24px" onclick="toggleStreamKeyVisibility()">
      <i class="fas fa-low-vision"></i>
    </button>
    <button id="copystreamkey" class="btn btn-primary" style="font-size:24px" onclick="copyStreamKey()">
      <i class="far fa-copy"></i>
    </button>
  </p>
  <br/>
  <p class="lead">
    Use this as stream key, and send this link to your viewers :<br/>
    <strong><a id="streamurl" href="" target="_blank">Loading...</a></strong>
  </p>
  <br/>
  <hr/>
  <br/>
  <p class="text-muted" style="max-width:480px;margin:auto;">
    NOTE : Do not share private information during quick streams. The fact that the streams are unlisted on the main site doesn't mean they are perfectly protected from indiscrete eyes. For private streams, please <a href="#">create an account</a>.
    <br/><br/>
    Remember that the sites rules apply on quick streams. Moderators can and will review quick streams if there is suspicion that a stream might infringe the rules.
    <br/><br/>
    In addition to private streams, <a href="#">creating an account</a> offers multiple advantages, such as creating channels, growing an audience, monetizing your streams, and more!
  </p>
  <br/>
  <br/>
</div>

<progress id="progress-bar" max=100 value=0></progress>

<script>
  function toggleStreamKeyVisibility() {
    var input = $('#streamkey')[0];
    if (input.type == "text") {
      input.type = "password";
    } else {
      input.type = "text";
    }
  }

  function createTempStream() {
    fetch("/api/quickstream/create", {
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      method: "POST",
      body: JSON.stringify({})
    })
    .then(function(res){ res.text().then((json)=>{
      json = JSON.parse(json);
      $('#streamkey')[0].value = json.key;
      $('#streamurl')[0].innerHTML = '<a href="https://fluvicast.com/live/' + json.url + '" targer="_blank">https://fluvicast.com/live/' + json.url + '</a>';
    }); })
    .catch(function(res){
      //console.log("Nuuu... " + res)
      alert('Could not generate stream key. Please report this error to the devs, with a screenshot of the console (press F12).');
    })
  }
  createTempStream();

  function copyStreamKey() {
    
  }
</script>